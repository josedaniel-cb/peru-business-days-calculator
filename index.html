<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Peru Business Days Calculator</title>
    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>
    <script>
      let pyodideInstance = null;

      async function loadPyodideAndPackages() {
        if (!pyodideInstance) {
          pyodideInstance = await loadPyodide({
            indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.2/full/",
          });
          await pyodideInstance.loadPackage("micropip");
          await pyodideInstance.runPythonAsync(`
            from datetime import datetime, timedelta

            # Definir los feriados
            feriados = [
                "01/01/2024","02/01/2024","28/03/2024","29/03/2024","01/05/2024","29/06/2024","07/06/2024","23/07/2024","26/07/2024","28/07/2024",
                "29/07/2024","06/08/2024","30/08/2024","07/10/2024","07/10/2024","08/10/2024","01/11/2024","06/12/2024","08/12/2024","09/12/2024",
                "23/12/2024","24/12/2024","25/12/2024","30/12/2024","31/12/2024","01/01/2023","02/01/2023","06/04/2023","07/04/2023","01/05/2023",
                "29/06/2023","30/06/2023","06/08/2023","23/07/2023","27/07/2023","28/07/2023","29/07/2023","30/08/2023","08/10/2023","09/10/2023",
                "01/11/2023","07/12/2023","08/12/2023","09/12/2023","25/12/2023","26/12/2023"
            ]

            # Convertir los feriados al formato datetime
            feriados = [datetime.strptime(date, "%d/%m/%Y") for date in feriados]

            # Función para calcular días hábiles
            def calcular_dias_habiles(fecha_inicio, fecha_fin, feriados):
                dias_habiles = 0
                fecha_actual = fecha_inicio

                while fecha_actual <= fecha_fin:
                    # Verificar si no es fin de semana y no es feriado
                    if fecha_actual.weekday() < 5 and fecha_actual not in feriados:
                        dias_habiles += 1
                    fecha_actual += timedelta(days=1)

                return dias_habiles
          `);
        }
        return pyodideInstance;
      }

      async function calcularDiasHabiles(startDate, endDate) {
        let pyodide = await loadPyodideAndPackages();

        if (startDate && endDate) {
          let result = await pyodide.runPythonAsync(`
            from datetime import datetime, timedelta

            fecha_inicio = datetime.strptime("${startDate}", "%Y-%m-%d") + timedelta(days=1)
            fecha_fin = datetime.strptime("${endDate}", "%Y-%m-%d")
            dias_habiles = calcular_dias_habiles(fecha_inicio, fecha_fin, feriados)
            dias_habiles
          `);
          return result;
        }
        return null;
      }
    </script>
  </head>
  <body>
    <div id="app">
      <form @input="handleInput">
        <label for="start-date">Fecha Inicio:</label>
        <input type="date" id="start-date" v-model="startDate" required />

        <label for="end-date">Fecha Fin:</label>
        <input type="date" id="end-date" v-model="endDate" required />

        <label for="result">Resultado:</label>
        <input type="text" id="result" v-model="businessDays" disabled />
      </form>
    </div>

    <script>
      const app = Vue.createApp({
        data() {
          return {
            startDate: "",
            endDate: "",
            businessDays: "",
          };
        },
        methods: {
          async handleInput() {
            if (this.startDate && this.endDate) {
              const result = await calcularDiasHabiles(
                this.startDate,
                this.endDate
              );
              this.businessDays = result;
            }
          },
        },
      });

      app.mount("#app");
    </script>
  </body>
</html>
